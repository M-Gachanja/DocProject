{% extends 'documents/base.html' %}

{% block content %}
<!-- Header Section -->
<div class="d-flex justify-content-between align-items-center mb-5">
    <div>
        <h2 class="mb-2" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
            <i class="fas fa-folder-open me-3"></i>My Document Library
        </h2>
        <p class="text-white-50 mb-0">Manage and organize all your uploaded documents</p>
    </div>
    <div class="d-flex gap-3">
        <a href="{% url 'document_upload' %}" class="btn btn-primary">
            <i class="fas fa-plus me-2"></i>Upload New Document
        </a>
        <a href="{% url 'search' %}" class="btn btn-outline-primary">
            <i class="fas fa-search me-2"></i>Search Documents
        </a>
    </div>
</div>

<!-- Stats Cards -->
<div class="row g-4 mb-5">
    <div class="col-lg-3 col-md-6">
        <div class="card h-100" style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1)); border: 1px solid rgba(255, 255, 255, 0.2);">
            <div class="card-body text-center">
                <div class="mb-3">
                    <i class="fas fa-file-alt fa-3x" style="background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;"></i>
                </div>
                <h4 class="mb-1" style="color: white;">{{ documents|length }}</h4>
                <p class="text-white-50 mb-0">Total Documents</p>
            </div>
        </div>
    </div>
    
    


<!-- Documents Grid -->
{% if documents %}
    <div class="row g-4">
        {% for document in documents %}
        <div class="col-lg-6 col-xl-4">
            <div class="card document-card h-100">
                <div class="card-body d-flex flex-column">
                    <!-- Document Icon and Type -->
                    <div class="d-flex align-items-start mb-3">
                        <div class="flex-shrink-0 me-3">
                            {% with document.file.name|slice:"-4:" as file_ext %}
                                {% if file_ext == ".pdf" %}
                                    <div class="document-icon pdf">
                                        <i class="fas fa-file-pdf fa-2x"></i>
                                    </div>
                                {% elif file_ext == ".doc" or file_ext == "docx" %}
                                    <div class="document-icon doc">
                                        <i class="fas fa-file-word fa-2x"></i>
                                    </div>
                                {% elif file_ext == ".jpg" or file_ext == ".png" or file_ext == "jpeg" %}
                                    <div class="document-icon img">
                                        <i class="fas fa-file-image fa-2x"></i>
                                    </div>
                                {% else %}
                                    <div class="document-icon default">
                                        <i class="fas fa-file fa-2x"></i>
                                    </div>
                                {% endif %}
                            {% endwith %}
                        </div>
                        <div class="flex-grow-1">
                            <h5 class="card-title mb-2">{{ document.title|truncatechars:50 }}</h5>
                            <div class="document-meta">
                                <small class="text-muted d-flex align-items-center mb-1">
                                    <i class="fas fa-calendar-alt me-1"></i>
                                    {{ document.uploaded_at|date:"M d, Y" }}
                                </small>
                                <small class="text-muted d-flex align-items-center">
                                    <i class="fas fa-clock me-1"></i>
                                    {{ document.uploaded_at|timesince }} ago
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Description -->
                    <div class="mb-3 flex-grow-1">
                        {% if document.description %}
                            <p class="card-text text-muted small">{{ document.description|truncatewords:20 }}</p>
                        {% else %}
                            <p class="card-text text-muted small fst-italic">No description provided</p>
                        {% endif %}
                    </div>
                    
                    <!-- Tags -->
                    <div class="mb-3">
                        {% if document.tags %}
                            {% for tag in document.tags|make_list %}
                                {% if tag != ',' %}
                                    <span class="badge bg-secondary me-1 mb-1">{{ tag|capfirst }}</span>
                                {% endif %}
                            {% endfor %}
                        {% else %}
                            <span class="text-muted small">No tags</span>
                        {% endif %}
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="d-flex gap-2 mt-auto">
                        {% if document.file %}
                            <a href="{% url 'download_document' document.id %}" 
                               class="btn btn-primary btn-sm flex-fill"
                               title="Download document">
                                <i class="fas fa-download me-1"></i>
                            </a>
                            <a href="{{ document.file.url }}" 
                               class="btn btn-outline-secondary btn-sm"
                               target="_blank"
                               title="View document">
                                <i class="fas fa-eye"></i>
                            </a>
                        {% else %}
                            <button class="btn btn-outline-danger btn-sm flex-fill" disabled>
                                <i class="fas fa-exclamation-triangle me-1"></i>No file
                            </button>
                        {% endif %}
                        <a href="{% url 'document_detail' document.id %}" 
                           class="btn btn-outline-info btn-sm"
                           title="View details">
                            <i class="fas fa-info-circle"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <!-- Load More Button (if pagination is implemented) -->
    <div class="text-center mt-5">
        <p class="text-white-50 mb-3">Showing {{ documents|length }} document{{ documents|length|pluralize }}</p>
        <!-- You can add pagination controls here if needed -->
    </div>
    
{% else %}
    <!-- Empty State -->
    <div class="row justify-content-center">
        <div class="col-lg-6">
            <div class="card text-center">
                <div class="card-body py-5">
                    <div class="mb-4">
                        <i class="fas fa-folder-open fa-5x text-muted"></i>
                    </div>
                    <h4 class="mb-3">No Documents Found</h4>
                    <p class="text-muted mb-4">
                        Your document library is empty. Start by uploading your first document to get organized!
                    </p>
                    <div class="d-flex gap-3 justify-content-center flex-wrap">
                        <a href="{% url 'document_upload' %}" class="btn btn-primary">
                            <i class="fas fa-cloud-upload-alt me-2"></i>Upload First Document
                        </a>
                        <a href="{% url 'home' %}" class="btn btn-outline-secondary">
                            <i class="fas fa-home me-2"></i>Back to Home
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endif %}
{% endblock %}

{% block extra_js %}
<style>
.document-icon {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

.document-icon.pdf {
    background: linear-gradient(135deg, #ff6b6b, #ffa726);
    color: white;
}

.document-icon.doc {
    background: linear-gradient(135deg, #4facfe, #00f2fe);
    color: white;
}

.document-icon.img {
    background: linear-gradient(135deg, #fa709a, #fee140);
    color: white;
}

.document-icon.default {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
}

.document-card {
    transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    position: relative;
    overflow: hidden;
}

.document-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    transform: scaleX(0);
    transition: transform 0.3s ease;
}

.document-card:hover {
    transform: translateY(-8px) scale(1.02);
}

.document-card:hover::before {
    transform: scaleX(1);
}

.document-meta {
    font-size: 0.8rem;
}

/* Animation for document cards */
@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.document-card {
    animation: slideInUp 0.6s ease-out;
}

/* Staggered animation delay */
.document-card:nth-child(1) { animation-delay: 0.1s; }
.document-card:nth-child(2) { animation-delay: 0.2s; }
.document-card:nth-child(3) { animation-delay: 0.3s; }
.document-card:nth-child(4) { animation-delay: 0.4s; }
.document-card:nth-child(5) { animation-delay: 0.5s; }
.document-card:nth-child(6) { animation-delay: 0.6s; }

/* Hover effect for action buttons */
.btn:hover {
    transform: translateY(-2px);
}

/* Badge hover effect */
.badge:hover {
    transform: scale(1.1);
    transition: transform 0.2s ease;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add hover effects to document icons
    const documentIcons = document.querySelectorAll('.document-icon');
    documentIcons.forEach(icon => {
        icon.addEventListener('mouseenter', function() {
            this.style.transform = 'scale(1.1) rotate(5deg)';
            this.style.transition = 'all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
        });
        
        icon.addEventListener('mouseleave', function() {
            this.style.transform = 'scale(1) rotate(0deg)';
        });
    });
    
    // Add click animation to download buttons
    const downloadButtons = document.querySelectorAll('a[href*="download"]');
    downloadButtons.forEach(button => {
        button.addEventListener('click', function() {
            this.style.transform = 'scale(0.95)';
            setTimeout(() => {
                this.style.transform = 'scale(1)';
            }, 150);
        });
    });
    
    // Intersection Observer for scroll animations
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver(function(entries) {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
                entry.target.classList.add('animate-in');
            }
        });
    }, observerOptions);

    // Observe document cards for scroll animation
    const documentCards = document.querySelectorAll('.document-card');
    documentCards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(30px)';
        card.style.transition = `all 0.6s ease-out ${index * 0.1}s`;
        observer.observe(card);
    });
    
    // Add tooltip functionality
    const tooltipElements = document.querySelectorAll('[title]');
    tooltipElements.forEach(element => {
        element.addEventListener('mouseenter', function() {
            const tooltip = document.createElement('div');
            tooltip.className = 'custom-tooltip';
            tooltip.textContent = this.getAttribute('title');
            tooltip.style.cssText = `
                position: absolute;
                background: rgba(0, 0, 0, 0.8);
                color: white;
                padding: 5px 10px;
                border-radius: 4px;
                font-size: 12px;
                pointer-events: none;
                z-index: 1000;
                white-space: nowrap;
            `;
            document.body.appendChild(tooltip);
            
            const rect = this.getBoundingClientRect();
            tooltip.style.left = rect.left + (rect.width / 2) - (tooltip.offsetWidth / 2) + 'px';
            tooltip.style.top = rect.top - tooltip.offsetHeight - 5 + 'px';
            
            this.tooltip = tooltip;
            this.removeAttribute('title');
        });
        
        element.addEventListener('mouseleave', function() {
            if (this.tooltip) {
                this.tooltip.remove();
                this.setAttribute('title', this.tooltip.textContent);
                this.tooltip = null;
            }
        });
    });
});
</script>
{% endblock %}